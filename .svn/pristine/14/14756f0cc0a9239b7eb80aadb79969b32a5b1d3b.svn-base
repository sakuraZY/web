<!--
 * @Description: 解封信息
 * @Author: wangjiayu
 * @Date: 2020-03-13 11:32:11
 * @LastEditors: wangjiayu
 * @LastEditTime: 2020-03-18 11:48:54
 -->

<template>
  <div class="jfxx-box" v-show="isVisible">
    <h3 id="t6" ref="t6">解封信息</h3>
    <el-form :model="jfxxForm" :rules="jfxxFormRules" ref="jfxxForm" size="medium">
      <el-row :gutter="20">
        <el-col :span='8'>
        <el-form-item label="解封机关" prop='jfjg'>
          <el-input  v-model.number="jfxxForm.jfjg" placeholder="请输入解封机关"></el-input>
        </el-form-item>
        </el-col>
        <el-col :span='8'>
        <el-form-item label="解封文号" prop='jfwh'>
          <el-input v-model="jfxxForm.jfwh" placeholder="请输入解封文号" ></el-input>
        </el-form-item>
        </el-col>
        <el-col :span='7'>
          <el-form-item label="解封日期" prop='jfrq'>
            <el-date-picker type="date"  v-model.trim="jfxxForm.jfrq" placeholder="解封日期"
              style="width: 100%;"></el-date-picker>
          </el-form-item>
        </el-col>
      </el-row>
      <el-row :gutter="20">
        <el-col :span='8'>
          <el-form-item label="联系电话" prop='lxdh'>
            <el-input v-model.number="jfxxForm.lxdh" placeholder="请输入联系电话"></el-input>
          </el-form-item>
        </el-col>
      </el-row>
    </el-form>
  </div>
</template>

<script>
import { validPhone } from '@/libs/validate';
import { formatDate } from '@/libs/date';

export default {
  props: {
    jfxx: {
      type: Object,
      default: () => ({}),
    },
    isVisible: {
      type: Boolean,
      default: false,
    },
  },
  data() {
    const defaultJFXX = {
      jfjg: '',
      jfwh: '',
      jfrq: '',
      lxdh: '',
    };
    return {
      jfxxForm: Object.keys(this.jfxx).length ? { ...this.jfxx } : defaultJFXX,
      jfxxFormRules: {
        jfjg: [{ required: true, message: '解封机关不能为空', trigger: 'blur' }],
        jfwh: [{ required: true, message: '解封文号不能为空', trigger: 'blur' }],
        jfrq: [{ required: true, message: '解封日期不能为空', trigger: 'blur' }],
        lxdh: [{ required: true, validator: this.checkPhone, trigger: 'blur' }],
      },
    };
  },
  methods: {
    // 检验电话号码
    checkPhone(rule, value, callback) {
      if (validPhone(value)) {
        callback();
      } else {
        callback(new Error('请填写正确的联系方式'));
      }
    },
    // 验证解封信息是否正确
    checkJFXX() {
      const errorMsg = [];
      this.$refs.jfxxForm.validateField(['jfjg', 'jfwh', 'jfrq', 'lxdh'], (errorMessage) => {
        errorMsg.push(errorMessage);
      });
      if (errorMsg.some(item => !!item)) {
        return false;
      }
      return true;
    },
    // 获取解封信息
    getJFXX() {
      if (this.jfxxForm.jfrq) {
        this.jfxxForm.jfrq = formatDate(this.jfxxForm.jfrq);
      }
      return this.jfxxForm;
    },
  },
};
</script>

<style lang="scss" scoped>
.jfxx-box {
  margin-right: 20px;
  width:100%;
}
</style>
